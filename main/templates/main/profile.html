{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>íšŒì› ì •ë³´ ìˆ˜ì • | RunningX</title>

  <style>
    body {
      margin: 0;
      font-family: "Pretendard", system-ui, sans-serif;
      overflow: hidden;
      height: 100dvh;
      display: flex;
    }

    /* ì¢Œì¸¡ ì˜ìƒ ì˜ì—­ */
    .video-side {
      flex: none;
      width: 43%;
      background: black;
      position: relative;
      overflow: hidden;
      /* ëŒ€ê°ì„  êµ¬ë¶„ì„  110ë„ */
      clip-path: polygon(0 0, 100% 0, calc(100% - 80px) 100%, 0 100%);
    }

    video {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 1.5s ease-in-out;
      will-change: opacity;
    }

    /* ìš°ì¸¡ ì½˜í…ì¸  ì˜ì—­ */
    .content-side {
      flex: none;
      width: 57%;
      background: white;
      color: black;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      padding-left: 80px;
      opacity: 0;
      transform: translateX(30px);
      transition: opacity 1s ease, transform 1s ease;
      /* ëŒ€ê°ì„  êµ¬ë¶„ì„  110ë„ */
      clip-path: polygon(80px 0, 100% 0, 100% 100%, 0 100%);
    }

    /* fade-out ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes fadeOutLeft {
      from { opacity: 1; transform: translateX(0); }
      to { opacity: 0; transform: translateX(-30px); }
    }

    .fade-out {
      animation: fadeOutLeft 0.5s forwards;
    }

    /* í¼ ìŠ¤íƒ€ì¼ */
    h2 { font-size: 32px; font-weight: 600; margin-top: 10px; margin-bottom: 10px; }
    hr {
      width: 120px;
      border: 0;
      border-top: 1px solid #ccc;
      margin: 10px 0;
    }
    form { font-size: 18px; line-height: 1.8em; }
    label { display: block; margin-bottom: 5px; font-weight: 500; }
    input { display: block; margin-bottom: 15px; width: 300px; padding: 6px; font-size: 16px; }
    button {
      background: #222;
      color: #fff;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      font-size: 18px;
    }
    a {
      display: inline-block;
      margin-top: 20px;
      color: #333;
      text-decoration: none;
      font-weight: 600;
    }

    /* ëª¨ë°”ì¼ ëŒ€ì‘ */
    @media (max-width: 900px) {
      body { flex-direction: column; height: auto; overflow: visible; }
      .video-side { display: none; }
      .content-side {
        width: 100%;
        padding: 40px 20px;
        align-items: center;
        justify-content: flex-start;
        transform: none !important;
        opacity: 1 !important;
        clip-path: none !important;
      }
      input { width: 90%; }
    }
  </style>
</head>

<body>
  <!-- ì¢Œì¸¡ ì˜ìƒ -->
  <div class="video-side">
    <video id="runnerVideo" autoplay muted playsinline>
      <source src="{% static 'main/videos/profileloop.mp4' %}?v=5" type="video/mp4">
      ë¸Œë¼ìš°ì €ê°€ ë™ì˜ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </video>
  </div>

  <!-- ìš°ì¸¡ ì½˜í…ì¸  -->
  <div class="content-side" id="contentSide">
    <h2>íšŒì› ì •ë³´ ìˆ˜ì •</h2>
    <hr>
    <p>ë‹¨ìœ„ëŠ” ë¹¼ê³  ì–‘ì˜ ì‹¤ìˆ˜ë¡œë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”!</p>

    {% if error_message %}
      <p style="color:red;">{{ error_message }}</p>
    {% endif %}

    <form method="post" id="profileForm">
      {% csrf_token %}

      <label>ëª¸ë¬´ê²Œ (kg)</label>
      <input type="text" name="weight" value="{{ profile.weight }}">

      <label>ì„ í˜¸ ëŸ¬ë‹ ê±°ë¦¬ (m)</label>
      <input type="text" name="preferred_distance" value="{{ profile.preferred_distance }}">

      <label>ì„ í˜¸ ëŸ¬ë‹ ì‚¬ì´í´ (íšŒ)</label>
      <input type="text" name="preferred_cycle" value="{{ profile.preferred_cycle }}">

      <button type="submit">ì €ì¥</button>
    </form>

    <a href="{% url 'main:home' %}" class="fade-link">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>

  <script>
    const video = document.getElementById("runnerVideo");
    const contentSide = document.getElementById("contentSide");
    const links = document.querySelectorAll(".fade-link");
    const form = document.getElementById("profileForm");
    const allContentElements = Array.from(contentSide.children);

    // ğŸ í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜ìƒ + ì½˜í…ì¸  ë™ì‹œì— í˜ì´ë“œì¸
    window.addEventListener("load", () => {
      // --- ì˜ìƒ í˜ì´ë“œì¸ ---
      video.style.opacity = "0";
      video.style.transition = "opacity 1.5s ease-in-out";
      void video.offsetWidth; // ê°•ì œ ë¦¬í”Œë¡œìš°
      requestAnimationFrame(() => {
        requestAnimationFrame(() => { video.style.opacity = "1"; });
      });
      video.play().catch(() => {
        document.body.addEventListener("touchstart", () => video.play(), { once: true });
      });

      // --- ì½˜í…ì¸  í˜ì´ë“œì¸ ---
      contentSide.style.opacity = "0";
      contentSide.style.transform = "translateX(30px)";
      contentSide.style.transition = "opacity 1s ease, transform 1s ease";
      void contentSide.offsetWidth;
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          contentSide.style.opacity = "1";
          contentSide.style.transform = "translateX(0)";
        });
      });
    });

    // ì˜ìƒ ìì—°ìŠ¤ëŸ¬ìš´ ë°˜ë³µ
    const FADE_TIME = 1.2;
    video.addEventListener("timeupdate", () => {
      if (video.duration - video.currentTime <= FADE_TIME) {
        video.style.opacity = "0";
      }
    });
    video.addEventListener("ended", () => {
      video.currentTime = 0.01;
      video.play();
      setTimeout(() => { video.style.opacity = "1"; }, FADE_TIME * 1000);
    });

    // í™ˆ ë§í¬ í´ë¦­ ì‹œ fade-out í›„ ì´ë™
    links.forEach(link => {
      link.addEventListener("click", function(e){
        e.preventDefault();
        const href = this.getAttribute("href");
        allContentElements.forEach(el => el.classList.add("fade-out"));
        setTimeout(() => { window.location.href = href; }, 500);
      });
    });

    // í¼ ì œì¶œ ì‹œ fade-out í›„ ì „ì†¡
    form.addEventListener("submit", function(e){
      e.preventDefault();
      allContentElements.forEach(el => el.classList.add("fade-out"));
      setTimeout(() => { form.submit(); }, 500);
    });
  </script>
</body>
</html>
